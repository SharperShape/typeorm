{"version":3,"sources":["../browser/src/find-options/FindOptionsUtils.ts"],"names":[],"mappings":"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","file":"FindOptionsUtils.js","sourcesContent":["import {Any, Between, Equal, ILike, In, LessThan, Like, MoreThan, Not, Raw} from \"..\";\nimport {FindOperator} from \"./FindOperator\";\nimport {FindOptions} from \"./FindOptions\";\n\n/**\n * Utilities to work with FindOptions.\n */\nexport class FindOptionsUtils {\n\n    /**\n     * Checks if given object is really instance of FindOneOptions interface.\n     */\n    static isFindOptions(obj: any): obj is FindOptions<any> {\n        const possibleOptions: FindOptions<any> = obj;\n        return possibleOptions && (\n            possibleOptions.select instanceof Object ||\n            possibleOptions.where instanceof Object ||\n            possibleOptions.relations instanceof Object ||\n            possibleOptions.order instanceof Object ||\n            possibleOptions.options instanceof Object ||\n            possibleOptions.cache instanceof Object ||\n            possibleOptions.lock instanceof Object ||\n            typeof possibleOptions.cache === \"boolean\" ||\n            typeof possibleOptions.cache === \"number\" ||\n            typeof possibleOptions.skip === \"number\" ||\n            typeof possibleOptions.take === \"number\" ||\n            typeof possibleOptions.skip === \"string\" ||\n            typeof possibleOptions.take === \"string\"\n        );\n    }\n\n}\n\n/**\n * Normalizes find options.\n */\nexport function normalizeFindOptions<T>(options: FindOptions<T>): FindOptions<T> {\n\n    const where = options.where;\n    if (!where)\n        return { ...options };\n    if (!(where instanceof Object))\n        return { ...options };\n    if (where instanceof FindOperator)\n        return { ...options };\n\n    const recursively$FindOption = (obj: any) => {\n        const valueKeys = Object.keys(obj);\n        if (valueKeys.length === 1) {\n            let value = obj[valueKeys[0]];\n            if (value instanceof Object && !(value instanceof Array) && !(value instanceof Function))\n                value = recursively$FindOption(value);\n\n            if (valueKeys[0] === \"$any\") {\n                return Any(value);\n\n            } else if (valueKeys[0] === \"$between\") {\n                return Between(value[0], value[1]);\n\n            } else if (valueKeys[0] === \"$equal\") {\n                return Equal(value);\n\n            } else if (valueKeys[0] === \"$iLike\") {\n                return ILike(value);\n\n            } else if (valueKeys[0] === \"$in\") {\n                return In(value);\n\n            } else if (valueKeys[0] === \"$lessThan\") {\n                return LessThan(value);\n\n            } else if (valueKeys[0] === \"$like\") {\n                return Like(value);\n\n            } else if (valueKeys[0] === \"$moreThan\") {\n                return MoreThan(value);\n\n            } else if (valueKeys[0] === \"$not\") {\n                return Not(value);\n\n            } else if (valueKeys[0] === \"$raw\") {\n                return Raw(value);\n            }\n        }\n\n        return false;\n    };\n\n    const recursivelyWhere = <T extends any>(where: T): T => {\n\n        if (Array.isArray(where)) {\n            return where.map((where: any) => recursivelyWhere(where)) as T;\n        }\n\n        return Object.keys(where as { [key: string ]: any }).reduce((newWhere, key) => {\n            const value = (where as { [key: string]: any })[key];\n\n            if (value instanceof Object && !(value instanceof FindOperator)) {\n                newWhere[key] = recursively$FindOption(value);\n\n                // in the case if $find operator was not found we'll have a false as a value\n                // we need to recursive where because it can be another where options\n                if (newWhere[key] === false)\n                    newWhere[key] = recursivelyWhere(value);\n\n            } else {\n                newWhere[key] = value;\n            }\n            return newWhere;\n        }, {} as { [key: string]: any }) as T;\n    };\n\n    // todo: broken after merge\n    // if (options.lock) {\n    //     if (options.lock.mode === \"optimistic\") {\n    //         qb.setLock(options.lock.mode, options.lock.version as any);\n    //     } else if (options.lock.mode === \"pessimistic_read\" || options.lock.mode === \"pessimistic_write\" || options.lock.mode === \"dirty_read\" || options.lock.mode === \"pessimistic_partial_write\" || options.lock.mode === \"pessimistic_write_or_fail\") {\n    //         qb.setLock(options.lock.mode);\n    //     }\n    // }\n\n    return { ...options, where: recursivelyWhere(options.where!) };\n}\n"],"sourceRoot":".."}